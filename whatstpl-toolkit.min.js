!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WhatsTplToolkit=t():e.WhatsTplToolkit=t()}(global,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n.w={},n(n.s=3)}([function(e,t,n){"use strict";function i(e){if("/"==e)return e;let n=e.replace(/\\/g,"/").lastIndexOf("/");return n<0||"/"==e?".":n==e.length-1?i(e.substring(0,n)):e.substring(0,n).replace(/\/|\\/g,t.Separator)}function s(e,t=""){let n=i(e),s="./"==n&&null==e.match(/^\.[\/\\]/)?e:e.substring(n.length+1);if(t){let e=s.lastIndexOf(t);s=e>=0?s.substring(0,e):s}return s}function l(e){let n=e.split(/\/|\\/);for(let e=0;e<n.length;e++)".."==n[e]?(n.splice(e-1,2),e-=2):"."==n[e]&&(n.splice(e,1),e-=1);return n.join(t.Separator)}function r(){return t.IsBrowser?location.protocol+"//"+location.host+i(location.pathname):process.cwd()}function o(e){return"/"==e[0]||null!=e.match(/^[a-zA-Z0-9]+:[\/\\]/)}Object.defineProperty(t,"__esModule",{value:!0}),t.IsBrowser="object"==typeof window&&"function"==typeof XMLHttpRequest,t.Separator=t.IsBrowser?"/":"win32"==process.platform?"\\":"/",t.escape=function(e){return String(e).replace(/<\/?[^>]*>/g,"")},t.dirname=i,t.basename=s,t.extname=function(e){let t=s(e),n=t.lastIndexOf(".");return n>=0?t.substring(n):""},t.normalizePath=l,t.getCwd=r,t.isAbsPath=o,t.getAbsPath=function(e){if(!o(e)){let n=r();e=n+("/"==n[n.length-1]?"":t.Separator)+e}return l(e)},t.getObjectValues=function(e){let t=[];for(let n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},t.getFunctionBodyOffset=function(e){let t=e.toString(),n=t.indexOf("{")+1,i=t.slice(0,n).split("\n"),s="\n"==t[n],l=s?0:i[i.length-1].indexOf("{")+2;return{line:s?i.length:i.length-1,column:l}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UnclosedTagError=class extends SyntaxError{constructor(e,t,n,i){super(e),this.filename=t,this.line=n,this.column=i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(0),l=/([0-9a-zA-Z:\-]+)\s*=\s*|([0-9a-zA-Z:\-]+)\s*/;class r{constructor(e=""){this.listeners={},this.outputTags=r.OutputTags,this.blockTags=r.BlockTags,this.filename=e?s.getAbsPath(e):"undefined",this.renewRegExp(),this.on("block",e=>{let t=e.attributes;if("block"==e.tag)this.blockTags.push(t.name.value),this.renewRegExp();else if("import"==e.tag&&t.target&&t.target.value){let e=t.target.value.split(/,\s*/);for(let t in e){let n=e[t].split(/\s+as\s+/);e[t]=n[1]||n[0]}this.blockTags=this.blockTags.concat(e),this.renewRegExp()}})}renewRegExp(){let e=this.blockTags.join("|"),t="\x3c!--(.*?)--\x3e|\x3c!--(.*)|("+this.outputTags.join("|")+"){(.+?)}|<("+e+")[\\s|\\/|>]|<\\/("+e+")>";this.regexp=new RegExp(t)}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}emit(e,...t){if(!this.listeners[e]||!this.listeners[e].length)return!1;for(let n of this.listeners[e])n(...t);return!0}parse(e){let t={tag:"root",type:"root",line:1,column:1,contents:[],closed:!1};return this.html=e.trimRight().replace(/\r\n|\r/g,"\n"),this.parseHtml(this.html,1,1,t),t}getLine(e,t){let n,i;for(;;){let s=e.indexOf("\n");if(n=(s>=0?e.substring(0,s):e).trimRight(),i=s>=0?e.substring(s+1):"",n||!i)break;t+=1,e=i}return{lineStr:n,left:i,line:t}}attachTextNode(e,t,n,i,s){let l={type:"text",line:t,column:n,contents:i?e.substring(0,i):e+"\n",closed:!0};l.contents.trimLeft()&&(s.push(l),this.emit("text",l))}parseHtml(e,t,n=1,s){let l=this.getLine(e,t),o=l.lineStr,c=o.match(this.regexp),u=s.contents;if(e=l.left,t=l.line,c)if(c[1]&&"script"!=s.tag){c.index&&(this.attachTextNode(o,t,n,c.index,u),n+=c.index);let i=o.substring(c.index+c[0].length),s={type:"comment",line:t,column:n,contents:c[0],closed:!1};u.push(s),this.emit("comment",s),i?(e=i+"\n"+e,n+=c[0].length):(s.contents+="\n",t+=1,n=1)}else if(c[2]&&"script"!=s.tag){c.index&&(this.attachTextNode(o,t,n,c.index,u),n+=c.index);let i={type:"comment",line:t,column:n,contents:o.substring(c.index),closed:!1};t+=1,n=1;let s=this.parseComment(e,t,n,i);u.push(i),this.emit("comment",i),e=s.left,t=s.line,n=s.column}else if(c[3]&&c[4]){c.index&&(this.attachTextNode(o,t,n,c.index,u),n+=c.index),n+=2;let i={tag:c[3],type:"var",line:t,column:n,contents:c[4],closed:!0};u.push(i),this.emit("var",i);let s=c.index+c[4].length+3,l=o.substring(s);l.trimRight()?(e=l+(e?"\n"+e:""),n+=c[4].length+1):(t+=1,n=1)}else if(c[5]&&"script"!=s.tag){c.index&&(this.attachTextNode(o,t,n,c.index,u),n+=c.index);let s=c.index+c[0].length,l=o[s-1],r={tag:c[5],type:"block",line:t,column:n,attributes:{},contents:[],closed:!1};"/"!=l&&">"!=l||(s-=1);let a=o.substring(s);if(!a&&e){n=1;let i=this.getLine(e,t);i.lineStr&&(a=i.lineStr,e=i.left)}if(!a)throw new i.UnclosedTagError("unclosed tag",this.filename,t,n);e=a+(e?"\n"+e:""),n+=c[0].length;let h=this.applyAttr(e,t,n,r.attributes);r.closed=h.blockClosed,h.left&&!r.closed&&(h=this.parseHtml(h.left,h.line,h.column,r)),u.push(r),this.emit("block",r),e=h.left,t=h.line,n=h.column}else if(c[6]&&c[6]==s.tag){c.index&&"script"!=s.tag&&this.attachTextNode(o,t,n,c.index,u),s.closed=!0;let i=c.index+c[0].length,l=o.substring(i);l?(e=l+(e?"\n"+e:""),n+=i):(t+=1,n=1)}else this.attachTextNode(o,t,n,NaN,u),t+=1,n=1;else{if("script"==s.tag&&s.attributes.engine&&s.attributes.engine.value==r.EngineName){let e={type:"snippet",line:t,column:n,contents:o+"\n",closed:!0};u.push(e),this.emit("snippet",e)}else this.attachTextNode(o,t,n,NaN,u);t+=1,n=1}return e&&!s.closed?this.parseHtml(e,t,n,s):(s.closed=!0,{line:t,column:n,left:e})}applyAttr(e,t,n,s){let r,o,c=this.getLine(e,t),u=c.lineStr,a=u.match(l);if(t=c.line,e=c.left,!a){let s=u.indexOf(">");if(-1===s)throw new i.UnclosedTagError("unclosed tag",this.filename,t,n);{n+=s+1;let i=u.substring(s+1);i?e=i+"\n"+e:(t+=1,n=1)}return{line:t,column:n,left:e,blockClosed:"/"==u[s-1]}}let h,f,p,g=!0;if(a[1]){let e,t=a.index+a[0].length,i=u[t];(g="'"!=i&&'"'!=i)||(t+=1),g?-1===(e=u.indexOf("/",t))&&(e=u.indexOf(">",t)):e=u.indexOf(i,t),r=a[1],o=-1===e?"":u.substring(t,e),p=u.substring(e+1),n+=t}else a[2]&&(r=o=a[2].trim(),p=u.substring(a.index+a[0].length),n+=a.index);if(f="/"==(h=p?p.trimLeft()[0]:""),s[r]={name:r,value:o,line:t,column:n},"/"==h?p=p.substring(2):">"==h&&(p=p.substring(1)),p?(e=p+"\n"+e,n+=(a[1]?o.length:a[0].length)+(g?0:1)):(t+=1,n=1),!h||">"!=h&&"/"!=h)return this.applyAttr(e,t,n,s);{let i;return">"==h?i=p.indexOf(">")+1:"/"==h&&(i=p.indexOf("/>")+2),{line:t,column:n+=i,left:e,blockClosed:f}}}parseComment(e,t,n,i){let s=this.getLine(e,t),l=s.lineStr,r=l&&l.match(/-->/);if(t=s.line,e=s.left,l&&(i.contents+="\n"),!r)return i.contents+=l,t+=1,n=1,e?this.parseComment(e,t,n,i):{line:t,column:n,left:e};{r.index&&(i.contents+=l.substring(0,r.index)),i.contents+=r[0],i.closed=!0,n+=r.index+3;let s=l.substring(n);s?e=s+"\n"+e:(t+=1,n=1)}return{line:t,column:n,left:e}}}r.EngineName="whatstpl",r.BlockTags=["layout","import","export","block","if","else-if","else","switch","case","for","while","do","continue","break","script"],r.OutputTags=["!","@","#"],t.Parser=r},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(1)),i(n(2)),i(n(0))}])});
//# sourceMappingURL=whatstpl-toolkit.min.js.map