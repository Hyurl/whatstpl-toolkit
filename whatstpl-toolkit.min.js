!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.WhatsTplToolkit=e():t.WhatsTplToolkit=e()}(this,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n.w={},n(n.s=3)}([function(t,e,n){"use strict";function i(t){if("/"==t)return t;var n=t.replace(/\\/g,"/").lastIndexOf("/");return n<0||"/"==t?".":n==t.length-1?i(t.substring(0,n)):t.substring(0,n).replace(/\/|\\/g,e.Separator)}function r(t,e){void 0===e&&(e="");var n=i(t),r="."==n&&null==t.match(/^\.[\/\\]/)?t:t.substring(n.length+1);if(e){var o=r.lastIndexOf(e);r=o>=0?r.substring(0,o):r}return r}function o(t){for(var n=t.split(/\/|\\/),i=0;i<n.length;i++)".."==n[i]?(n.splice(i-1,2),i-=2):"."==n[i]&&(n.splice(i,1),i-=1);return n.join(e.Separator)}function s(){return e.IsBrowser?location.protocol+"//"+location.host+i(location.pathname):process.cwd()}function l(t){return"/"==t[0]||/^[a-zA-Z]:[\/\\]/.test(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.IsBrowser="object"==typeof window&&"function"==typeof XMLHttpRequest,e.Separator=e.IsBrowser?"/":"win32"==process.platform?"\\":"/",e.escape=function(t){return String(t).replace(/<\/?[^>]*>/g,"")},e.dirname=i,e.basename=r,e.extname=function(t){var e=r(t),n=e.lastIndexOf(".");return n>=0?e.substring(n):""},e.normalizePath=o,e.getCwd=s,e.isAbsPath=l,e.getAbsPath=function(t){if(!l(t)){var n=s();t=n+("/"==n[n.length-1]?"":e.Separator)+t}return o(t)},e.getObjectValues=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(t[n]);return e},e.getFunctionBodyOffset=function(t){var e=t.toString(),n=e.indexOf("{")+1,i=e.slice(0,n).split("\n"),r="\n"==e[n],o=r?0:i[i.length-1].indexOf("{")+2;return{line:r?i.length:i.length-1,column:o}}},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,n,i,r){var o=t.call(this,e)||this;return o.filename=n,o.line=i,o.column=r,o}return r(e,t),e}(SyntaxError);e.UnclosedTagError=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=n(0),o=/([0-9a-zA-Z:\-]+)\s*=\s*|([0-9a-zA-Z:\-]+)\s*/,s=function(){function t(e){var n=this;void 0===e&&(e=""),this.listeners={},this.outputTags=t.OutputTags,this.blockTags=t.BlockTags,this.filename=e?r.getAbsPath(e):"undefined",this.renewRegExp(),this.on("block",function(t){var e=t.attributes;if("block"==t.tag)n.blockTags.push(e.name.value),n.renewRegExp();else if("import"==t.tag&&e.target&&e.target.value){var i=e.target.value.split(/,\s*/);for(var r in i){var o=i[r].split(/\s+as\s+/);i[r]=o[1]||o[0]}n.blockTags=n.blockTags.concat(i),n.renewRegExp()}})}return t.prototype.renewRegExp=function(){var t=this.blockTags.join("|"),e="\x3c!--(.*?)--\x3e|\x3c!--(.*)|("+this.outputTags.join("|")+"){(.+?)}|<("+t+")[\\s|\\/|>]|<\\/("+t+")>";this.regexp=new RegExp(e)},t.prototype.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!this.listeners[t]||!this.listeners[t].length)return!1;for(var i=0,r=this.listeners[t];i<r.length;i++){r[i].apply(void 0,e)}return!0},t.prototype.parse=function(t){var e={tag:"root",type:"root",line:1,column:1,contents:[],closed:!1};return this.html=t.trimRight().replace(/\r\n|\r/g,"\n"),this.parseHtml(this.html,1,1,e),e},t.prototype.getLine=function(t,e){for(var n,i;;){var r=t.indexOf("\n");if(n=(r>=0?t.substring(0,r):t).trimRight(),i=r>=0?t.substring(r+1):"",n||!i)break;e+=1,t=i}return{lineStr:n,left:i,line:e}},t.prototype.attachTextNode=function(t,e,n,i,r,o){void 0===o&&(o=!1);var s={type:"text",line:e,column:n,contents:i?t.substring(0,i):t+"\n",closed:!0};(o||s.contents.trimLeft())&&(r.push(s),this.emit("text",s))},t.prototype.parseHtml=function(e,n,r,o){void 0===r&&(r=1);var s=this.getLine(e,n),l=s.lineStr,a=l.match(this.regexp),c=o.contents;if(e=s.left,n=s.line,a)if(a[1]&&"script"!=o.tag){a.index&&(this.attachTextNode(l,n,r,a.index,c),r+=a.index);var u=l.substring(a.index+a[0].length),p={type:"comment",line:n,column:r,contents:a[0],closed:!1};c.push(p),this.emit("comment",p),u?(e=u+"\n"+e,r+=a[0].length):(p.contents+="\n",n+=1,r=1)}else if(a[2]&&"script"!=o.tag){a.index&&(this.attachTextNode(l,n,r,a.index,c),r+=a.index);p={type:"comment",line:n,column:r,contents:l.substring(a.index),closed:!1};n+=1,r=1;var f=this.parseComment(e,n,r,p);c.push(p),this.emit("comment",p),e=f.left,n=f.line,r=f.column}else if(a[3]&&a[4]){a.index&&(this.attachTextNode(l,n,r,a.index,c,"!"!=a[3]),r+=a.index),r+=2;var h={tag:a[3],type:"var",line:n,column:r,contents:a[4],closed:!0};c.push(h),this.emit("var",h);var g=a.index+a[4].length+3;(u=l.substring(g)).trimRight()?(e=u+(e?"\n"+e:""),r+=a[4].length+1):(n+=1,r=1)}else if(a[5]&&"script"!=o.tag){a.index&&(this.attachTextNode(l,n,r,a.index,c),r+=a.index);var d=l[(g=a.index+a[0].length)-1],m="/"==d||">"==d,x={tag:a[5],type:"block",line:n,column:r,attributes:{},contents:[],closed:!1};if(m&&(g-=1),!(u=l.substring(g))&&e){r=1;var v=this.getLine(e,n);v.lineStr&&(u=v.lineStr,e=v.left)}if(!u)throw new i.UnclosedTagError("unclosed tag",this.filename,n,r);e=u+(e?"\n"+e:""),r+=a[0].length,m&&(r-=1);f=this.applyAttr(e,n,r,x.attributes);x.closed=f.blockClosed,f.left&&!x.closed&&(f=this.parseHtml(f.left,f.line,f.column,x)),c.push(x),this.emit("block",x),e=f.left,n=f.line,r=f.column}else if(a[6]&&a[6]==o.tag){a.index&&"script"!=o.tag&&this.attachTextNode(l,n,r,a.index,c),o.closed=!0;g=a.index+a[0].length;(u=l.substring(g))?(e=u+(e?"\n"+e:""),r+=g):(n+=1,r=1)}else this.attachTextNode(l,n,r,NaN,c),n+=1,r=1;else{if("script"==o.tag&&o.attributes.engine&&o.attributes.engine.value==t.EngineName){var b={type:"snippet",line:n,column:r,contents:l+"\n",closed:!0};c.push(b),this.emit("snippet",b)}else this.attachTextNode(l,n,r,NaN,c);n+=1,r=1}return e&&!o.closed?this.parseHtml(e,n,r,o):(o.closed=!0,{line:n,column:r,left:e})},t.prototype.applyAttr=function(t,e,n,r){var s,l,a=this.getLine(t,e),c=a.lineStr,u=c.trimLeft()[0],p="/"==u||">"==u?null:c.match(o);if(e=a.line,t=a.left,!p){var f=c.indexOf(">");if(-1===f)throw new i.UnclosedTagError("unclosed tag",this.filename,e,n);n+=f+1;var h=c.substring(f+1);return h?t=h+"\n"+t:(e+=1,n=1),{line:e,column:n,left:t,blockClosed:"/"==u}}var g,d=!0;if(p[1]){var m=p.index+p[0].length,x=c[m],v=void 0;(d="'"==x||'"'==x)&&(m+=1),d?v=c.indexOf(x,m):-1===(v=c.indexOf("/",m))&&(v=c.indexOf(">",m)),s=p[1],l=-1===v?"":c.substring(m,v),g=c.substring(v+1),n+=m}else p[2]&&(s=l=p[2].trim(),g=c.substring(p.index+p[0].length),n+=p.index);return r[s]={name:s,value:l,line:e,column:n},g?(t=g+"\n"+t,n+=p[1]?l.length:p[0].length,n+=d?1:0):(e+=1,n=1),this.applyAttr(t,e,n,r)},t.prototype.parseComment=function(t,e,n,i){var r=this.getLine(t,e),o=r.lineStr,s=o&&o.match(/-->/);if(e=r.line,t=r.left,o&&(i.contents+="\n"),!s)return i.contents+=o,e+=1,n=1,t?this.parseComment(t,e,n,i):{line:e,column:n,left:t};s.index&&(i.contents+=o.substring(0,s.index)),i.contents+=s[0],i.closed=!0,n+=s.index+3;var l=o.substring(n);return l?t=l+"\n"+t:(e+=1,n=1),{line:e,column:n,left:t}},t.EngineName="whatstpl",t.BlockTags=["layout","import","export","block","if","else-if","else","switch","case","default","for","while","do","continue","break","script"],t.OutputTags=["!","@","#"],t}();e.Parser=s},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(1)),i(n(2)),i(n(0))}])});
//# sourceMappingURL=whatstpl-toolkit.min.js.map