!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.WhatsTplToolkit=e():t.WhatsTplToolkit=e()}(this,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n.w={},n(n.s=3)}([function(t,e,n){"use strict";function i(t){if("/"==t)return t;let n=t.replace(/\\/g,"/").lastIndexOf("/");return n<0||"/"==t?".":n==t.length-1?i(t.substring(0,n)):t.substring(0,n).replace(/\/|\\/g,e.Separator)}function s(t,e=""){let n=i(t),s="./"==n&&null==t.match(/^\.[\/\\]/)?t:t.substring(n.length+1);if(e){let t=s.lastIndexOf(e);s=t>=0?s.substring(0,t):s}return s}function l(t){let n=t.split(/\/|\\/);for(let t=0;t<n.length;t++)".."==n[t]?(n.splice(t-1,2),t-=2):"."==n[t]&&(n.splice(t,1),t-=1);return n.join(e.Separator)}function r(){return e.IsBrowser?location.protocol+"//"+location.host+i(location.pathname):process.cwd()}function o(t){return"/"==t[0]||null!=t.match(/^[a-zA-Z0-9]+:[\/\\]/)}Object.defineProperty(e,"__esModule",{value:!0}),e.IsBrowser="object"==typeof window&&"function"==typeof XMLHttpRequest,e.Separator=e.IsBrowser?"/":"win32"==process.platform?"\\":"/",e.escape=function(t){return String(t).replace(/<\/?[^>]*>/g,"")},e.dirname=i,e.basename=s,e.extname=function(t){let e=s(t),n=e.lastIndexOf(".");return n>=0?e.substring(n):""},e.normalizePath=l,e.getCwd=r,e.isAbsPath=o,e.getAbsPath=function(t){if(!o(t)){let n=r();t=n+("/"==n[n.length-1]?"":e.Separator)+t}return l(t)},e.getObjectValues=function(t){let e=[];for(let n in t)t.hasOwnProperty(n)&&e.push(t[n]);return e},e.getFunctionBodyOffset=function(t){let e=t.toString(),n=e.indexOf("{")+1,i=e.slice(0,n).split("\n"),s="\n"==e[n],l=s?0:i[i.length-1].indexOf("{")+2;return{line:s?i.length:i.length-1,column:l}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.UnclosedTagError=class extends SyntaxError{constructor(t,e,n,i){super(t),this.filename=e,this.line=n,this.column=i}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(1),s=n(0),l=/([0-9a-zA-Z:\-]+)\s*=\s*|([0-9a-zA-Z:\-]+)\s*/;class r{constructor(t=""){this.listeners={},this.outputTags=r.OutputTags,this.blockTags=r.BlockTags,this.filename=t?s.getAbsPath(t):"undefined",this.renewRegExp(),this.on("block",t=>{let e=t.attributes;if("block"==t.tag)this.blockTags.push(e.name.value),this.renewRegExp();else if("import"==t.tag&&e.target&&e.target.value){let t=e.target.value.split(/,\s*/);for(let e in t){let n=t[e].split(/\s+as\s+/);t[e]=n[1]||n[0]}this.blockTags=this.blockTags.concat(t),this.renewRegExp()}})}renewRegExp(){let t=this.blockTags.join("|"),e="\x3c!--(.*?)--\x3e|\x3c!--(.*)|("+this.outputTags.join("|")+"){(.+?)}|<("+t+")[\\s|\\/|>]|<\\/("+t+")>";this.regexp=new RegExp(e)}on(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}emit(t,...e){if(!this.listeners[t]||!this.listeners[t].length)return!1;for(let n of this.listeners[t])n(...e);return!0}parse(t){let e={tag:"root",type:"root",line:1,column:1,contents:[],closed:!1};return this.html=t.trimRight().replace(/\r\n|\r/g,"\n"),this.parseHtml(this.html,1,1,e),e}getLine(t,e){let n,i;for(;;){let s=t.indexOf("\n");if(n=(s>=0?t.substring(0,s):t).trimRight(),i=s>=0?t.substring(s+1):"",n||!i)break;e+=1,t=i}return{lineStr:n,left:i,line:e}}attachTextNode(t,e,n,i,s,l=!1){let r={type:"text",line:e,column:n,contents:i?t.substring(0,i):t+"\n",closed:!0};(l||r.contents.trimLeft())&&(s.push(r),this.emit("text",r))}parseHtml(t,e,n=1,s){let l=this.getLine(t,e),o=l.lineStr,c=o.match(this.regexp),u=s.contents;if(t=l.left,e=l.line,c)if(c[1]&&"script"!=s.tag){c.index&&(this.attachTextNode(o,e,n,c.index,u),n+=c.index);let i=o.substring(c.index+c[0].length),s={type:"comment",line:e,column:n,contents:c[0],closed:!1};u.push(s),this.emit("comment",s),i?(t=i+"\n"+t,n+=c[0].length):(s.contents+="\n",e+=1,n=1)}else if(c[2]&&"script"!=s.tag){c.index&&(this.attachTextNode(o,e,n,c.index,u),n+=c.index);let i={type:"comment",line:e,column:n,contents:o.substring(c.index),closed:!1};e+=1,n=1;let s=this.parseComment(t,e,n,i);u.push(i),this.emit("comment",i),t=s.left,e=s.line,n=s.column}else if(c[3]&&c[4]){c.index&&(this.attachTextNode(o,e,n,c.index,u,"!"!=c[3]),n+=c.index),n+=2;let i={tag:c[3],type:"var",line:e,column:n,contents:c[4],closed:!0};u.push(i),this.emit("var",i);let s=c.index+c[4].length+3,l=o.substring(s);l.trimRight()?(t=l+(t?"\n"+t:""),n+=c[4].length+1):(e+=1,n=1)}else if(c[5]&&"script"!=s.tag){c.index&&(this.attachTextNode(o,e,n,c.index,u),n+=c.index);let s=c.index+c[0].length,l=o[s-1],r="/"==l||">"==l,a={tag:c[5],type:"block",line:e,column:n,attributes:{},contents:[],closed:!1};r&&(s-=1);let h=o.substring(s);if(!h&&t){n=1;let i=this.getLine(t,e);i.lineStr&&(h=i.lineStr,t=i.left)}if(!h)throw new i.UnclosedTagError("unclosed tag",this.filename,e,n);t=h+(t?"\n"+t:""),n+=c[0].length,r&&(n-=1);let f=this.applyAttr(t,e,n,a.attributes);a.closed=f.blockClosed,f.left&&!a.closed&&(f=this.parseHtml(f.left,f.line,f.column,a)),u.push(a),this.emit("block",a),t=f.left,e=f.line,n=f.column}else if(c[6]&&c[6]==s.tag){c.index&&"script"!=s.tag&&this.attachTextNode(o,e,n,c.index,u),s.closed=!0;let i=c.index+c[0].length,l=o.substring(i);l?(t=l+(t?"\n"+t:""),n+=i):(e+=1,n=1)}else this.attachTextNode(o,e,n,NaN,u),e+=1,n=1;else{if("script"==s.tag&&s.attributes.engine&&s.attributes.engine.value==r.EngineName){let t={type:"snippet",line:e,column:n,contents:o+"\n",closed:!0};u.push(t),this.emit("snippet",t)}else this.attachTextNode(o,e,n,NaN,u);e+=1,n=1}return t&&!s.closed?this.parseHtml(t,e,n,s):(s.closed=!0,{line:e,column:n,left:t})}applyAttr(t,e,n,s){let r,o,c=this.getLine(t,e),u=c.lineStr,a=u.trimLeft()[0],h="/"==a||">"==a?null:u.match(l);if(e=c.line,t=c.left,!h){let s=u.indexOf(">");if(-1===s)throw new i.UnclosedTagError("unclosed tag",this.filename,e,n);{n+=s+1;let i=u.substring(s+1);i?t=i+"\n"+t:(e+=1,n=1)}return{line:e,column:n,left:t,blockClosed:"/"==a}}let f,p=!0;if(h[1]){let t,e=h.index+h[0].length,i=u[e];(p="'"==i||'"'==i)&&(e+=1),p?t=u.indexOf(i,e):-1===(t=u.indexOf("/",e))&&(t=u.indexOf(">",e)),r=h[1],o=-1===t?"":u.substring(e,t),f=u.substring(t+1),n+=e}else h[2]&&(r=o=h[2].trim(),f=u.substring(h.index+h[0].length),n+=h.index);return s[r]={name:r,value:o,line:e,column:n},f?(t=f+"\n"+t,n+=h[1]?o.length:h[0].length,n+=p?1:0):(e+=1,n=1),this.applyAttr(t,e,n,s)}parseComment(t,e,n,i){let s=this.getLine(t,e),l=s.lineStr,r=l&&l.match(/-->/);if(e=s.line,t=s.left,l&&(i.contents+="\n"),!r)return i.contents+=l,e+=1,n=1,t?this.parseComment(t,e,n,i):{line:e,column:n,left:t};{r.index&&(i.contents+=l.substring(0,r.index)),i.contents+=r[0],i.closed=!0,n+=r.index+3;let s=l.substring(n);s?t=s+"\n"+t:(e+=1,n=1)}return{line:e,column:n,left:t}}}r.EngineName="whatstpl",r.BlockTags=["layout","import","export","block","if","else-if","else","switch","case","default","for","while","do","continue","break","script"],r.OutputTags=["!","@","#"],e.Parser=r},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(1)),i(n(2)),i(n(0))}])});
//# sourceMappingURL=whatstpl-toolkit.min.js.map